# Настройка PlasmoVoice на Proxy

В этом руководстве описан процесс настройки PlasmoVoice на прокси-сервере (Velocity или BungeeCord/Waterfall)

## 1. Выделение портов

Перед настройкой необходимо создать отдельные порты типа `PlasmoVoice` для:
1. Вашего **Прокси-сервера**
2. **Каждого** игрового сервера (Lobby, Survival, Anarchy и т.д.), подключенного к прокси

::: info Как создать порт
1. Перейдите во вкладку **Network (Порты)** в панели управления
2. Нажмите кнопку **Create Port (Создать порт)**
3. В выпадающем списке выберите тип **PlasmoVoice**
:::

Запишите полученные порты. Например:
* **Proxy Voice Port:** `30000` (этот порт будет в конфиге прокси в секции host)
* **Lobby Voice Port:** `30001` (этот порт будет в конфиге lobby сервера)
* **Survival Voice Port:** `30002` (этот порт будет в конфиге survival сервера)

## 2. Установка плагина

1. Скачайте версию плагина для **Velocity** или **Bungee** с [Modrinth](https://modrinth.com/plugin/plasmo-voice)
2. Загрузите `.jar` файл в папку `plugins` вашего прокси-сервера
3. Перезапустите прокси-сервер

## 3. Настройка конфигурации Proxy

Откройте файл `plugins/plasmovoice/config.toml` на прокси-сервере

### Настройка Host (Входящие соединения)

В этой секции указывается порт, через который игроки будут подключаться к голосовому чату

```toml
[host]
ip = "0.0.0.0"
port = 30000 # Укажите порт PlasmoVoice, выделенный для PROXY сервера
```

### Настройка Servers (Связь с серверами)

Так как порты игры и войса не совпадают, прокси-сервер должен знать, куда пересылать звук

1. Раскомментируйте секцию `[servers]` (уберите символы `#`)
2. Впишите названия ваших серверов (как они названы в конфиге прокси `velocity.toml` или `config.yml`)
3. Укажите IP и **порт PlasmoVoice**, который вы выделили для конкретного режима

```toml
[servers]
# Имя сервера = "IP:ПОРТ_PLASMOVOICE_ЭТОГО_СЕРВЕРА"

lobby = "127.0.0.1:30001"
survival = "127.0.0.1:30002"
anarchy = "127.0.0.1:30003"
```

::: danger Внимание
В секции `[servers]` нужно указывать именно **UDP-порт PlasmoVoice**, а не порт подключения к Minecraft серверу (25565 и т.д.)
:::

## 4. Настройка секретного ключа (Forwarding Secret)

Для работы прокси требуется настроить секретный ключ шифрования, чтобы сервера доверяли друг другу

1. Запустите прокси-сервер один раз с установленным плагином
2. В папке `plugins/plasmovoice/` появится файл `forwarding-secret`
3. Скачайте этот файл себе на компьютер
4. Загрузите этот файл на **каждый** игровой сервер, подключенный к прокси

**Куда загружать файл:**
* **Paper/Spigot:** В папку `plugins/plasmovoice/`
* **Fabric/Forge:** В папку `config/plasmovoice/server/`

::: tip Важно
Файл `forwarding-secret` должен быть одинаковым на прокси и на всех игровых серверах. Если вы удалите или перегенерируете его на прокси, процедуру копирования нужно повторить
:::

## 5. Финальная проверка

1. Убедитесь, что в конфигах самих игровых серверов (на Backend) в поле `port` указаны соответствующие порты (30001, 30002 и т.д.), которые вы прописали в секции `[servers]` на прокси
2. Перезагрузите **прокси** и **все игровые сервера**

Теперь голосовой чат настроен и работает в связке прокси-сервер